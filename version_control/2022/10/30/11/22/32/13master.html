<p>前端开发参考文档</p>
<p>1.Uniapp官方文档：
<a href="https://uniapp.dcloud.net.cn/component/">https://uniapp.dcloud.net.cn/component/</a>
2.UView官方文档(1.X版本，不要看2.X文档): <a href="https://v1.uviewui.com/components/intro.html">https://v1.uviewui.com/components/intro.html</a>
3.ElementUI文档:
<a href="https://element.eleme.cn/#/zh-CN/component/installation">https://element.eleme.cn/#/zh-CN/component/installation</a>
4.后台管理端</p>
<p>1.如何获取当前登录管理员</p>
<p>继承抽象类AbstractController，调用<strong>getUser()</strong>即可。
如果只要管理员用户id，调用<strong>getUserId()</strong>即可。
package io.linfeng.modules.sys.controller</p>
<p>public abstract class AbstractController {
        …….
}
2.如何记录后台管理端的敏感操作日志</p>
<p>在后台管理端接口controller上添加注解@SysLog（”描述内容”）
@SysLog(“需要描述内容的信息”)
例如：
  @SysLog(“修改圈子分类”)
  @PostMapping(“/update”)
  @RequiresPermissions(“admin:category:update”)
  @ApiOperation(“修改分类”)
  public R update(@RequestBody CategoryEntity category){
        categoryService.updateById(category);
        return R.ok();
  }</p>
<ol>
<li>Swagger的文档使用</li></ol>
<p>访问地址:
本地：localhost:8080/doc.html
线上: 域名+/doc.html
<img src="![alt icecms](https://img.kancloud.cn/7b/1b/7b1b9f2388d531375650bfa070eeae8f_1919x873.png" alt="alt icecms"/>)
（1）如果测试的是后台管理系统的接口，那么在如上图所示的地方设置token（移动端也是这个地方设置），记得点击保存。token值可以直接从已登录后台的请求路径获取，直接复制过来。如下图所示：
<img src="![alt icecms](https://img.kancloud.cn/11/85/1185f13d0defe587fe1358f7e9a56d82_1911x889.png" alt="alt icecms"/>)
（2）如果测试的是用户端，token值可以通过用户端接口请求获取token，或者通过如下图方式复制token值。前提：已登录状态，否则找不到token值。
<img src="![alt icecms](https://img.kancloud.cn/28/41/2841e48de8ceb93d503fee93c29cf52c_1901x868.png" alt="alt icecms"/>)
很多用户由于没有设置token值，会导致swagger文档接口请求失败，响应内容如下所示：响应码401就是未登录，也就是没有设置token或token无效。
<img src="![alt icecms](https://img.kancloud.cn/7d/a4/7da464fe67165692d9dd1370ce08370d_1372x720.png" alt="alt icecms"/>)</p>
<p>用户端后端创建新接口</p>
<p>在该包下新建接口开发你的用户端二开内容
io.linfeng.modules.app.controller
（1）接口登录拦截</p>
<p>如果该接口需要当前用户信息，则在接口入参上添加@LoginUser注解注入用户信息，并添加@Login注解。如下所示：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="com">/**</span></code></li><li class="L1"><code class="lang-java"><span class="com"> * 评论区的点赞</span></code></li><li class="L2"><code class="lang-java"><span class="com"> */</span></code></li><li class="L3"><code class="lang-java"><span class="lit">@Login</span></code></li><li class="L4"><code class="lang-java"><span class="lit">@PostMapping</span><span class="pun">(</span><span class="str">&#34;/thumbs&#34;</span><span class="pun">)</span></code></li><li class="L5"><code class="lang-java"><span class="lit">@NoRepeatSubmit</span></code></li><li class="L6"><code class="lang-java"><span class="kwd">public</span><span class="pln"> R thumbs</span><span class="pun">(</span><span class="lit">@RequestBody</span><span class="pln"> </span><span class="typ">AddThumbsForm</span><span class="pln"> request</span><span class="pun">,</span><span class="lit">@LoginUser</span><span class="pln"> </span><span class="typ">AppUserEntity</span><span class="pln"> user</span><span class="pun">){</span></code></li><li class="L7"><code class="lang-java"></code></li><li class="L8"><code class="lang-java"><span class="pln">    commentThumbsService</span><span class="pun">.</span><span class="pln">addThumbs</span><span class="pun">(</span><span class="pln">request</span><span class="pun">,</span><span class="pln">user</span><span class="pun">);</span></code></li><li class="L9"><code class="lang-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> R</span><span class="pun">.</span><span class="pln">ok</span><span class="pun">();</span></code></li><li class="L0"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
<p>注意：使用@LoginUser注解就必须使用@Login注解！！！不然会报空指针异常。
如上代码中，我们发现还有一个@NoRepeatSubmit注解，该注解是防止接口的重复提交操作，保持接口幂等性。
（2）获取用户信息</p>
<p>如果确定你的新接口需要用户登录，那么你只需要按照第（1）条的说明进行操作，但是按照第（1）条的说明进行操作的话，会出现一个问题，即：如果用户端未登录，那么用户端会强制跳转到登录页。如果你不希望这样，那么就按照如下操作进行：
首先，controller接口处不再添加第（1）条的两个注解，你只需要注入LocalUser这个Bean，调用getUser()方法并判断该方法返回的当前用户信息是否为空即可。直接看代码：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="lit">@Override</span></code></li><li class="L1"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="typ">AppPageUtils</span><span class="pln"> lastPost</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> currPage</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">    </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">PostEntity</span><span class="pun">&gt;</span><span class="pln"> page </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Page</span><span class="pun">&lt;&gt;(</span><span class="pln">currPage</span><span class="pun">,</span><span class="lit">10</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-java"><span class="pln">    </span><span class="typ">QueryWrapper</span><span class="pun">&lt;</span><span class="typ">PostEntity</span><span class="pun">&gt;</span><span class="pln"> queryWrapper</span><span class="pun">=</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">QueryWrapper</span><span class="pun">&lt;&gt;();</span></code></li><li class="L4"><code class="lang-java"><span class="pln">    queryWrapper</span><span class="pun">.</span><span class="pln">lambda</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="typ">PostEntity</span><span class="pun">::</span><span class="pln">getStatus</span><span class="pun">,</span><span class="typ">Constant</span><span class="pun">.</span><span class="pln">POST_NORMAL</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"><span class="pln">    queryWrapper</span><span class="pun">.</span><span class="pln">orderByDesc</span><span class="pun">(</span><span class="str">&#34;post_top&#34;</span><span class="pun">,</span><span class="str">&#34;id&#34;</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">    </span><span class="typ">AppUserEntity</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> localUser</span><span class="pun">.</span><span class="pln">getUser</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-java"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="typ">ObjectUtil</span><span class="pun">.</span><span class="pln">isNull</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)){</span></code></li><li class="L8"><code class="lang-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">mapPostList</span><span class="pun">(</span><span class="pln">page</span><span class="pun">,</span><span class="pln"> queryWrapper</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L9"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">mapPostList</span><span class="pun">(</span><span class="pln">page</span><span class="pun">,</span><span class="pln"> queryWrapper</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">getUid</span><span class="pun">());</span></code></li><li class="L1"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
<p>提取关键代码即如下所示：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"></code></li><li class="L1"><code class="lang-java"><span class="lit">@Autowired</span></code></li><li class="L2"><code class="lang-java"><span class="kwd">private</span><span class="pln"> </span><span class="typ">LocalUser</span><span class="pln"> localUser</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-java"><span class="pun">...</span></code></li><li class="L4"><code class="lang-java"><span class="pun">...</span></code></li><li class="L5"><code class="lang-java"><span class="pun">...</span></code></li><li class="L6"><code class="lang-java"><span class="typ">AppUserEntity</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> localUser</span><span class="pun">.</span><span class="pln">getUser</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-java"><span class="kwd">if</span><span class="pun">(</span><span class="typ">ObjectUtil</span><span class="pun">.</span><span class="pln">isNull</span><span class="pun">(</span><span class="pln">user</span><span class="pun">)){</span></code></li><li class="L8"><code class="lang-java"><span class="pln">    </span><span class="com">//未登录时的业务逻辑</span></code></li><li class="L9"><code class="lang-java"><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L0"><code class="lang-java"><span class="pln">    </span><span class="com">//登录时的业务逻辑</span></code></li><li class="L1"><code class="lang-java"><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"><span class="lit">2.</span><span class="pun">创建新的定时任务</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pun">在该包下创建你的类</span></code></li><li class="L5"><code class="lang-java"><span class="pln">io</span><span class="pun">.</span><span class="pln">linfeng</span><span class="pun">.</span><span class="pln">modules</span><span class="pun">.</span><span class="pln">job</span><span class="pun">.</span><span class="pln">task</span></code></li><li class="L6"><code class="lang-java"><span class="pun">该类的类名需要和后台管理系统创建的“</span><span class="pln">bean</span><span class="pun">名称”一致。</span></code></li><li class="L7"><code class="lang-java"><span class="pun">比如：下图和对应的代码保持了一致的名称。参数即为传入的值。</span><span class="pln">cron</span><span class="pun">依照自己的需求设定时间。依葫芦画瓢即可。</span></code></li><li class="L8"><code class="lang-java"></code></li><li class="L9"><code class="lang-java"><span class="com">/**</span></code></li><li class="L0"><code class="lang-java"><span class="com"> *</span></code></li><li class="L1"><code class="lang-java"><span class="com"> * 定期清理所有消息定时任务</span></code></li><li class="L2"><code class="lang-java"><span class="com"> *</span></code></li><li class="L3"><code class="lang-java"><span class="com"> *</span></code></li><li class="L4"><code class="lang-java"><span class="com"> * @author linfeng</span></code></li><li class="L5"><code class="lang-java"><span class="com"> * @date 2022/5/8 16:58</span></code></li><li class="L6"><code class="lang-java"><span class="com"> */</span></code></li><li class="L7"><code class="lang-java"><span class="lit">@Component</span><span class="pun">(</span><span class="str">&#34;messageTask&#34;</span><span class="pun">)</span></code></li><li class="L8"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MessageTask</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ITask</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="lang-java"></code></li><li class="L0"><code class="lang-java"><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> logger </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LoggerFactory</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="pln">getClass</span><span class="pun">());</span></code></li><li class="L1"><code class="lang-java"></code></li><li class="L2"><code class="lang-java"><span class="pln">    </span><span class="lit">@Autowired</span></code></li><li class="L3"><code class="lang-java"><span class="pln">    </span><span class="lit">@Lazy</span></code></li><li class="L4"><code class="lang-java"><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">MessageService</span><span class="pln"> messageService</span><span class="pun">;</span></code></li><li class="L5"><code class="lang-java"></code></li><li class="L6"><code class="lang-java"></code></li><li class="L7"><code class="lang-java"><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L8"><code class="lang-java"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> params</span><span class="pun">){</span></code></li><li class="L9"><code class="lang-java"><span class="pln">        logger</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">&#34;messageTask定时任务正在执行，参数为：{}&#34;</span><span class="pun">,</span><span class="pln"> params</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">        </span><span class="com">//必须是整数而且为正数，代表清除几个月前的数据</span></code></li><li class="L1"><code class="lang-java"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="typ">NumberUtil</span><span class="pun">.</span><span class="pln">isInteger</span><span class="pun">(</span><span class="pln">params</span><span class="pun">)&amp;&amp;</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">params</span><span class="pun">)&gt;</span><span class="lit">0</span><span class="pun">){</span></code></li><li class="L2"><code class="lang-java"><span class="pln">            messageService</span><span class="pun">.</span><span class="pln">deleteMessageByMonth</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">params</span><span class="pun">));</span></code></li><li class="L3"><code class="lang-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
